I"u.<h1 id="device-management">Device Management:</h1>
<p>AWS IoT Device Management makes it easy to securely onboard, organize, monitor, and remotely manage IoT devices at scale. In this blog we will explore AWS IoT Device management in details.</p>

<h2 id="a-thing--a-device">A Thing == A Device:</h2>
<ul>
  <li>In AWS IoT, things are identified by a <strong><em>unique name</em></strong>.</li>
  <li>A thing is stored in the registry as <em>JSON</em> data.
    <ul>
      <li>:warning: <span style="color:grey">IoT Devices with valid certificates can connect to AWS IoT without a thing name registered for them.</span>.</li>
    </ul>
  </li>
</ul>

<h3 id="thing-attributes">Thing Attributes:</h3>
<ul>
  <li>Things can have <em>Attributes</em>, as <strong><em>name-value pairs</em></strong> that can be used to store information about the thing, such as its <em>serial number</em> or <em>manufacturer</em>.</li>
  <li>Thing name can be used as the default MQTT client ID (~though this is not mandatory, using this way, simplifies use of Shadow, Certificates).</li>
  <li>Attributes of a thing can be used to search all things with specific attribute value.
    <ul>
      <li>:heavy_check_mark: e.g. let’s say Attribute is Company Name = “Persistent”</li>
    </ul>
  </li>
</ul>

<h3 id="thing-types">Thing Types:</h3>
<ul>
  <li><span style="color:green">Things with a thing type</span> can have up to <strong><em>50 attributes</em></strong>.</li>
  <li><span style="color:grey">Things without a thing type</span> can have up to <strong><em>three attributes</em></strong>.</li>
  <li>A thing can be associated with only one thing type.</li>
  <li>Thing Types are <strong><em>Optional</em></strong>.</li>
  <li>There is <u>no limit</u> on the number of thing types you can create in your account.</li>
  <li>Thing types are <strong><em>immutable</em></strong>.</li>
  <li><em><u>Deprecate/Delete</u></em> Thing Type:
    <ul>
      <li>We cannot change a thing type name after it has been created.</li>
      <li>But we can Deprecate a thing type at any time to prevent new things from being associated with it.
        <ul>
          <li>All existing things associated with the thing type are unchanged.</li>
        </ul>
      </li>
      <li>Deprecating a thing type is a <em>reversible</em> operation. You can undo a deprecation.</li>
      <li>Delete thing types that have no things associated with them.</li>
      <li>Only deprecated thin types can be deleted.</li>
    </ul>
  </li>
</ul>

<h3 id="thing-groups">Thing Groups:</h3>
<ul>
  <li>We cannot rename a group once created.</li>
  <li>Groups can have Hierarchy, i.e. one group in another.
    <ul>
      <li><span style="color:grey">But thing group cannot be member of multiple thing groups.</span></li>
    </ul>
  </li>
  <li>Thing group can be mapped as child of another group <u>only at creation time</u>,
    <ul>
      <li>i.e., <u>Parent of a thing group cannot be changed after child group creation.</u></li>
    </ul>
  </li>
  <li>A group can have <strong><em>max 100 direct child groups</em></strong>.
    <ul>
      <li>group all floors within a building
        <ul>
          <li>group all rooms on the same floor
            <ul>
              <li>group all sensors in a room</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Each group can have up to <strong><em>50 Attributes</em></strong> ().</li>
  <li>Attach a policy to a parent group and it is inherited by its child groups, and by all of the things in the group and in its child groups.</li>
  <li><u>A thing can belong to one or more thing groups (up to 10 groups)</u>.</li>
  <li>Cannot add a thing to more than one group in the same hierarchy.</li>
  <li>Configure logging options for things in a group.</li>
  <li>Create jobs that are sent to and executed on each thing in a group and its child groups.</li>
  <li>Key Advantages of Thing Groups:
    <ul>
      <li>Updating IoT Policies gets easier with thing groups, as Policies are applied to all child groups and things registered in child and root thing group.</li>
      <li>When a thing is moved from a thing group to another thing group, new policies are dynamically applied w.r.t. new thing group.</li>
    </ul>
  </li>
  <li><strong><em><u>Dynamic Thing Groups</u></em></strong>:
    <ul>
      <li>Dynamic thing groups will automatically add devices that meet your specified criteria and remove the devices that no longer match the criteria.</li>
      <li>overrideDynamicGropus:
        <ul>
          <li>Override dynamic thing groups with static thing groups when 10-group limit is reached. If a thing belongs to 10 thing groups, and one or more of those groups are dynamic thing groups, adding a thing to a static group removes the thing from the last dynamic group.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="on-boarding--provisioning-of-devices">On-Boarding &amp; Provisioning of Devices:</h2>
<ul>
  <li>onboard connected devices in bulk.</li>
  <li>onboard new devices by using:
    <ul>
      <li>the IoT management console or</li>
      <li>APIs to upload templates that you populate with information like:
        <ul>
          <li>device manufacturer</li>
          <li>serial number</li>
          <li>X.509 identity certificates</li>
          <li>security policies</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Devices may either connect directly to IoT Core or connect indirectly via an AWS Greengrass powered gateway.</li>
  <li>AWS IoT provides four ways to provision devices:
    <ul>
      <li>single-thing provisioning</li>
      <li>bulk provisioning</li>
      <li>just-in-time provisioning (JITP)</li>
      <li>just-in-time registration (JITR)</li>
    </ul>
  </li>
</ul>

<h3 id="single-device-provisioning">Single device provisioning:</h3>
<ul>
  <li><u>Ideal use-cases</u>:
    <ul>
      <li>when your IoT solution requires you to provision either one device or a small number of devices at a time.</li>
      <li>If your company only has a handful of devices and you expect this number to grow slowly.</li>
    </ul>
  </li>
  <li><u>Ways</u>:
    <ul>
      <li>Using Management Console</li>
      <li>Using AWS CLI Commandline interface
<img src="/assets/images/aws/aws-cli-iot-thing-create.jpg" alt="AWS CLI: IoT Thing creation" />
<img src="/assets/images/aws/aws-cli-iot-cert-policy-create-attach.jpg" alt="AWS CLI: IoT Thing Certs and Policy creation" /></li>
      <li>Using register-thing API call</li>
    </ul>
  </li>
</ul>

<h3 id="bulk-provisioning-of-devices">Bulk provisioning of devices:</h3>
<ul>
  <li><u>Ideal use-cases:</u>
    <ul>
      <li>In situations such as migration of IoT devices.</li>
      <li>
        <p>In situations where your IoT device provisioning needs may be sporadic or unpredictable.</p>
      </li>
      <li>In a situation where the devices that sat on the shelf may have expired certificates, for instance.</li>
    </ul>
  </li>
  <li>Details:
    <ul>
      <li><a href="https://github.com/aws-samples/aws-iot-device-management-workshop/blob/master/AWS_IoT_Device_Management_Workshop.md#Bulk_Device_Provisioning">AWS IoT Device Management Workshop: Bulk Device Provisioning</a></li>
    </ul>
  </li>
</ul>

<h3 id="just-in-time-provisioning">Just-in-time-provisioning:</h3>
<p><img src="/assets/images/aws/aws-device-provisioning-jitp.png" alt="AWS IoT Device Provisioning JITP" /></p>
<ul>
  <li><u>Ideal use-cases</u>:
    <ul>
      <li>When you have a reached a point where it makes sense to consider provisioning in advance!
        <ul>
          <li>Like in cases of Consumer Products, which are produced in bulk but for a long time are not purchased.</li>
          <li>Such products need activation whenever they connect for the first time to cloud.</li>
          <li>the manufacturer cannot predict when a device will be used first-time and act on provisioning process.</li>
          <li>So, in such situations JITP is an ideal way.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Just-In-Time Provisioning (JITP) allows you to register devices dynamically.</li>
  <li>In order to use JITP:
    <ul>
      <li>you register your own CA with AWS IoT,</li>
      <li>enable automatic registration within AWS IoT</li>
      <li>associate the provisioning template to your CA.</li>
      <li>You will also generate your own public key infrastructure (PKI) keys and certificates</li>
      <li>and then copy them to your devices.</li>
    </ul>
  </li>
  <li>When your device connects to AWS IoT for the first time, AWS IoT automatically calls the <strong><em>RegisterThing</em></strong> API, its certificate is registered, and a notification is published to an internal topic (<em>$aws/events/certificates/registered/certificateID</em>).</li>
  <li>By using the <strong><em>AWS IoT Rules engine</em></strong>, the registration event can trigger an <strong><em>AWS Lambda</em></strong> function that takes the appropriate steps you need to meet your workflow requirements—for example, merging content from other resources (such as an on-premises database).</li>
</ul>

<h2 id="organize-devices">Organize Devices:</h2>
<ul>
  <li>group your device fleet into a hierarchical structure based on function, security requirements, or any other category.</li>
  <li>Use of Device Organization:
    <ul>
      <li>manage access policies</li>
      <li>view operational metrics</li>
      <li>perform actions on your devices across the entire group
        <h3 id="dynamic-thing-groups">Dynamic Thing Groups:</h3>
      </li>
    </ul>
  </li>
  <li>
    <p>dynamic thing groups will automatically add devices that meet your specified criteria and remove the devices that no longer match the criteria.</p>
  </li>
  <li>find device records for devices in the registry based on any combination of <strong><em>device attribute</em></strong> or <strong><em>state</em></strong> so that you can perform actions across the device group.</li>
  <li>use <strong><em>device connectivity indexing</em></strong> to quickly discover which devices are currently connected or disconnected to AWS IoT.</li>
</ul>

<h2 id="monitoring-devices">Monitoring Devices:</h2>
<h3 id="events-capabilities">events capabilities:</h3>
<ul>
  <li>Whenever a thing, group or type resource is <strong><em>created</em></strong>, <strong><em>updated</em></strong>, or <strong><em>deleted</em></strong>, IoT Device Management will post an <strong><em>MQTT message</em></strong> to a topic. We can match these messages via rules to take whatever actions we would like to make.</li>
  <li>Configure different <strong><em>log levels</em></strong>, such as, <em>info</em>, <em>debug</em>, <em>warnings</em>, and <em>errors</em> for different principles, such as thing groups.</li>
  <li>These logs will be published into <strong><em>CloudWatch</em></strong> in <em>JSON</em> format, that can easily <em>parse</em> and <em>search</em> through your logs.</li>
</ul>

<h2 id="remote-management-of-devices">Remote Management of devices:</h2>
<ul>
  <li>Push <strong><em>software and firmware updates</em></strong> to devices in the field to patch security vulnerabilities and improve device functionality.</li>
  <li>Execute <strong><em>bulk updates</em></strong>, <strong><em>control deployment</em></strong> velocity, <strong><em>set failure thresholds</em></strong>, and define <strong><em>continuous jobs</em></strong> to update device software automatically so they are always running the latest version.</li>
  <li>Send <em>actions</em> such as device <strong><em>reboots</em></strong> or <strong><em>factory resets</em></strong> remotely to fix software issues in the device or restore the device to its original settings.</li>
  <li><strong><em>Digitally Sign</em></strong> and __<em>Verify</em>__files that you send to your devices.</li>
  <li></li>
</ul>
:ET